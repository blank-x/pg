<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<div>H5è°ƒå‰ç½®æ‘„åƒå¤´DEMO</div>
<video id="video" width="480" height="320" muted controls autoPlay></video>
<div>
  <button id="capture">æ‹ç…§</button>
</div>
<canvas id="canvas" width="480" height="320"></canvas>
<script >
  function getUserMedia(constraints, success, error) {
    if (navigator.mediaDevices.getUserMedia) {
      //æœ€æ–°çš„æ ‡å‡†API
      navigator.mediaDevices
        .getUserMedia({
          audio: { echoCancellation: false },
          video: { facingMode: 'user' }, //è°ƒç”¨å‰ç½®æ‘„åƒå¤´ï¼Œåç½®æ‘„åƒå¤´ä½¿ç”¨video: { facingMode: { exact: "environment" } }
        })
        .then(success)
        .catch(error);
    } else if (navigator.webkitGetUserMedia) {
      //webkitæ ¸å¿ƒæµè§ˆå™¨
      navigator.webkitGetUserMedia(constraints, success, error);
    } else if (navigator.mozGetUserMedia) {
      //firfoxæµè§ˆå™¨
      navigator.mozGetUserMedia(constraints, success, error);
    } else if (navigator.getUserMedia) {
      //æ—§ç‰ˆAPI
      navigator.getUserMedia(constraints, success, error);
    }
  }
  let video = document.getElementById('video');
  let canvas = document.getElementById('canvas');
  let context = canvas.getContext('2d');

  function success(stream) {
    //å…¼å®¹webkitæ ¸å¿ƒæµè§ˆå™¨
    let CompatibleURL = window.URL || window.webkitURL;
    //å°†è§†é¢‘æµè®¾ç½®ä¸ºvideoå…ƒç´ çš„æº
    console.log(stream);

    //video.src = CompatibleURL.createObjectURL(stream);
    video.srcObject = stream;
    video.play();
  }

  function error(error) {
    console.log(`è®¿é—®ç”¨æˆ·åª’ä½“è®¾å¤‡å¤±è´¥${error.name}, ${error.message}`);
  }

  document.getElementById('capture').addEventListener('click', function () {
    const radio = video.videoWidth / video.videoHeight;
    const filterList = [
      'blur(5px)', // æ¨¡ç³Š
      'brightness(0.5)', // äº®åº¦
      'contrast(200%)', // å¯¹æ¯”åº¦
      'grayscale(100%)', // ç°åº¦
      'hue-rotate(90deg)', // è‰²ç›¸æ—‹è½¬
      'invert(100%)', // åè‰²
      'opacity(90%)', // é€æ˜åº¦
      'saturate(200%)', // é¥±å’Œåº¦
      'saturate(20%)', // é¥±å’Œåº¦
      'sepia(100%)', // è¤è‰²
      'drop-shadow(4px 4px 8px blue)', // é˜´å½±
    ];
    context.filter = filterList[0];
    if (480 / 320 > radio) {
      context.drawImage(video, 0, 0, 320 * radio, 320);
    } else {
      context.drawImage(video, 0, 0, 480, 480 / radio);
    }
  });

  if (
    navigator.mediaDevices.getUserMedia ||
    navigator.getUserMedia ||
    navigator.webkitGetUserMedia ||
    navigator.mozGetUserMedia
  ) {
    //è°ƒç”¨ç”¨æˆ·åª’ä½“è®¾å¤‡, è®¿é—®æ‘„åƒå¤´
    getUserMedia({ video: { width: 480, height: 320 } }, success, error);
  } else {
    alert('ä¸æ”¯æŒè®¿é—®ç”¨æˆ·åª’ä½“');
  }
  // console.log(navigator.mediaDevices.getSupportedConstraints());
  navigator.mediaDevices.enumerateDevices().then((devices)=>{
    console.log('ğŸš€ğŸš€ğŸš€ / devices', devices)
  })

</script>
</body>
</html>


